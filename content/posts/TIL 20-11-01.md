# 20.11.01

날짜: Nov 1, 2020
내용: JS - Final Project Back End Completed
내용 2: JS - Final Project Front and Back End Connected

# Back End of Final Project

## Profile and Image Counter

Profile function returns the information of the user, given the id number. And the Image counter function accumulates every time a user submits a image on the website.

```jsx
app.get('/profile/:id', (req, res) => {
	const { id } = req.params;
	let found = false;
	database.users.forEach(user => {
		if (user.id === id) {
			found = true;
			return res.json(user);
		}
	})
	if (!found) {
		res.status(400).json('not found')
	}
})
```

First of all, the id is passed as a parameter of profile through the URL. This is compared to the ids in the database, and when there's a hit, the function ends, returning the user. When the forEach loop is completed and no match has been found, it returns the status of 400.

```jsx
app.put('/image', (req, res) => {
	const { id } = req.body;
	let found = false;
	database.users.forEach(user => {
		if (user.id === id) {
			found = true;
			user.entries++
			return res.json(user.entries);
		}
	})
	if (!found) {
		res.status(400).json('not found')
	}
})
```

This function is triggered when the user submits an image through the page. It compares the id of the request and compares with the database. When a hit is found, the number of the "entries" is increased.

# Connecting the Back End to the Front End

## Connecting the Sign In and Register

To begin with, because when the two is connected, the page needs to remember the user information who is signed in. Therefore the state is modified.

```jsx
user: {
				id: '',
				name: '',
				email: '',
				entries: 0,
				joined: ''
			}
```

When the user submits a email address and password in the sign in page, the following happens. In order to receive these data, the sign in component of the front end is turned into a class and states are created.

```jsx
class Signin extends React.Component {
	constructor(props) {
		super(props);
		this.state = {
			signInEmail: '',
			signInPassword: ''
		}
	}
```

And when the values of the input changes, these states change accordingly.

```jsx
onEmailChange = (event) => {
		this.setState({signInEmail: event.target.value})
	}
	
	onPasswordChange = (event) => {
		this.setState({signInPassword: event.target.value})
	}
```

And when the button is clicked, this information is sent to the back end server with the post method, where the input email and password will be compared, and when a match has been found, the user information will be sent back to the front end, which will load user to the state of the App container, and redirect to the home page.

```jsx
onSubmitSignIn =() => {
	fetch('https://smart-brain-ggnai.run.goorm.io/signin', {
		method: 'post',
		headers: {'Content-Type': 'application/json'},
		body: JSON.stringify({
			email: this.state.signInEmail,
			password: this.state.signInPassword
		})
	})
		.then(response => response.json())
		.then (user => {
		if (user.id){
			this.props.loadUser(user);
			this.props.onRouteChange('home');
		}
	})
}
```

In the same logic, with name part included, register part is connected.

```jsx
class Register extends React.Component {
	constructor(props) {
		super(props);
		this.state = {
			email: '',
			password: '',
			name: ''
		}
	}
	
	onNameChange = (event) => {
		this.setState({name: event.target.value})
	}
	
	onEmailChange = (event) => {
		this.setState({email: event.target.value})
	}
	
	onPasswordChange = (event) => {
		this.setState({password: event.target.value})
	}
	
	onSubmitSignIn =() => {
		fetch('https://smart-brain-ggnai.run.goorm.io/register', {
			method: 'post',
			headers: {'Content-Type': 'application/json'},
			body: JSON.stringify({
				email: this.state.email,
				password: this.state.password,
				name: this.state.name
			})
		})
			.then(response => response.json())
			.then (user => {
			if (user){
				this.props.loadUser(user)
				this.props.onRouteChange('home');
			}
		})
	}
```

## Connecting Entry Submits to Rank

```jsx
onButtonSubmit = () => {
	this.setState({imageUrl: this.state.input})
	app.models
		.predict(
		'c0c0ac362b03416da06ab3fa36fb58e3',
		this.state.input)
	.then(response => {
		if(response) {
			fetch('https://smart-brain-ggnai.run.goorm.io/image', {
				method: 'put',
				headers: {'Content-Type': 'application/json'},
				body: JSON.stringify({
					id: this.state.user.id
				})
			})
			.then(response =>response.json())
			.then(count => {
				this.setState(Object.assign(this.state.user, { entries: count }))
			})
		}
		this.displayFaceBox(this.calculateFaceLocation(response))
	})
	
	.catch(err => console.log(err));
}
```

Like above, when the image submit button is clicked and it is processed through the face detect model, the user id in the state is sent to the back end through image URL, which will increase the entry count in the back end. Then this is returned to the front end, where it will also change the state in the front end as well, which will also be taken into account in the page rank display.

```jsx
import React from 'react';

const Rank = ({ name, entries }) => {
	return (
		<div>
			<div className='white f3'>
				{ `${name}, your entry count is...` }
			</div>
			<div className='white f1'>
				{ entries }
			</div>
		</div>
	)
}

export default Rank
```